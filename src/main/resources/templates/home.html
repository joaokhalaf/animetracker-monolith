<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AnimeTracker - Track Your Favorite Anime</title>

    <link rel="stylesheet" href="/css/tailwind.css">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-gray-100 text-gray-900">

    <nav class="bg-gray-900 text-white">
        <div class="container mx-auto flex items-center justify-between px-4 py-3">
            <a href="/" class="text-2xl font-bold">AnimeTracker</a>

            <button id="menuBtn" class="md:hidden focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>

            <ul id="menu" class="hidden md:flex md:space-x-6 items-center">
                <li><a href="/" class="hover:text-blue-400">Home</a></li>
                <li sec:authorize="isAuthenticated()"><a th:href="@{/favorites}" class="hover:text-blue-400">My Favorites</a></li>
                <li sec:authorize="isAuthenticated()"><a th:href="@{/favorite-lists}" class="hover:text-blue-400">My Lists</a></li>
                <li sec:authorize="!isAuthenticated()"><a th:href="@{/login}" class="hover:text-blue-400">Login</a></li>
                <li sec:authorize="!isAuthenticated()"><a th:href="@{/register}" class="hover:text-blue-400">Register</a></li>
                <li sec:authorize="isAuthenticated()" class="text-gray-300">
                    Welcome, <span th:text="${username}">User</span>
                </li>
                <li sec:authorize="isAuthenticated()">
                    <form th:action="@{/logout}" method="post" class="inline">
                        <button type="submit" class="hover:text-red-400">Logout</button>
                    </form>
                </li>
            </ul>
        </div>
    </nav>

    <main class="container mx-auto py-10 px-4">

        <div class="max-w-2xl mx-auto bg-white rounded-xl shadow p-8">
            <h1 class="text-3xl font-bold text-center mb-4">Track Your Anime Journey</h1>
            <p class="text-center text-gray-500 mb-6">Search for anime, create custom lists, and track your favorites</p>

            <form th:action="@{/search-results}" method="post" novalidate>
                <label for="sentiment" class="block text-sm font-medium mb-2">Search for anime by name</label>
                <textarea id="sentiment" name="sentiment" rows="3"
                          class="w-full border rounded-lg p-3 focus:ring-2 focus:ring-blue-400"
                          placeholder="Example: Naruto, Attack on Titan, Death Note, Your Name" required></textarea>
                <div class="text-center mt-6">
                    <button type="submit"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-2 rounded-lg">
                        Search Anime
                    </button>
                </div>
            </form>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-10">

            <div th:if="${trendingAnime != null and not #lists.isEmpty(trendingAnime)}">
                <h3 class="text-xl font-semibold flex items-center gap-2 mb-4">
                    <span class="text-red-500">üî•</span> Trending This Season
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div th:each="anime : ${trendingAnime}" class="bg-white rounded-lg shadow overflow-hidden">
                        <img th:src="${anime.imageUrl}" th:alt="${anime.title}"
                             class="w-full h-48 object-cover"
                             onerror="this.src='/images/no-image.jpg';">
                        <div class="p-3">
                            <h6 class="font-semibold" th:text="${anime.title}">Title</h6>
                            <p class="text-sm text-gray-500" th:text="${anime.genres}">Genres</p>
                        </div>
                    </div>
                </div>
            </div>

            <div th:if="${topRatedAnime != null and not #lists.isEmpty(topRatedAnime)}">
                <h3 class="text-xl font-semibold flex items-center gap-2 mb-4">
                    <span class="text-yellow-400">‚≠ê</span> Top Rated
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div th:each="anime : ${topRatedAnime}" class="bg-white rounded-lg shadow overflow-hidden">
                        <img th:src="${anime.imageUrl}" th:alt="${anime.title}"
                             class="w-full h-48 object-cover"
                             onerror="this.src='/images/no-image.jpg';">
                        <div class="p-3">
                            <h6 class="font-semibold" th:text="${anime.title}">Title</h6>
                            <p class="text-sm text-gray-500" th:text="${anime.genres}">Genres</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${isAuthenticated}" class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-10">
            <div th:if="${recentFavorites != null and not #lists.isEmpty(recentFavorites)}">
                <h3 class="text-xl font-semibold mb-4">Recent Favorites</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div th:each="anime : ${recentFavorites}" class="bg-white rounded-lg shadow overflow-hidden">
                        <img th:src="${anime.imageUrl}" th:alt="${anime.title}"
                             class="w-full h-52 object-cover">
                        <div class="p-3">
                            <h6 class="font-semibold" th:text="${anime.title}"></h6>
                            <p class="text-sm text-gray-500" th:text="${anime.genres}"></p>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <a th:href="@{/favorites}" class="text-blue-600 hover:underline font-medium">View All Favorites</a>
                </div>
            </div>

            <div th:if="${recentLists != null and not #lists.isEmpty(recentLists)}">
                <h3 class="text-xl font-semibold mb-4">My Lists</h3>
                <div class="space-y-3">
                    <a th:each="list : ${recentLists}"
                       th:href="@{/favorite-lists/{id}(id=${list.id})}"
                       class="block bg-white rounded-lg shadow p-4 hover:bg-gray-50">
                        <div class="flex justify-between items-center mb-1">
                            <h6 class="font-semibold" th:text="${list.name}"></h6>
                            <small th:text="${#temporals.format(list.createdAt, 'MMM dd')}"></small>
                        </div>
                        <p class="text-sm text-gray-600" th:text="${list.description}"></p>
                        <small class="text-gray-400" th:text="${#lists.size(list.animes)} + ' anime'"></small>
                    </a>
                </div>
                <div class="text-center mt-4">
                    <a th:href="@{/favorite-lists}" class="text-blue-600 hover:underline font-medium">View All Lists</a>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white text-center py-6 mt-10">
        <p>¬© 2025 AnimeTracker - Track and organize your favorite anime</p>
    </footer>

    <script>
        document.getElementById("menuBtn").addEventListener("click", () => {
            document.getElementById("menu").classList.toggle("hidden");
        });
    </script>

    <script src="/js/main.js"></script>
</body>
</html>
